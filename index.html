<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Street Helper - English Practice</title>
    <style>
        body { background: #f0f2f5; color: #333; font-family: 'Segoe UI', sans-serif; text-align: center; margin: 0; }
        #game-container { max-width: 800px; margin: 20px auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        #situation-box { height: 200px; display: flex; align-items: center; justify-content: center; font-size: 5rem; background: #eef2f3; border-radius: 10px; margin-bottom: 20px; }
        #instruction { font-size: 1.2rem; font-weight: bold; color: #555; margin-bottom: 10px; }
        #target-phrase { font-size: 1.8rem; color: #007bff; margin: 20px 0; min-height: 2.5rem; font-weight: bold; }
        #feedback { font-size: 1.2rem; height: 1.5rem; margin-top: 10px; }
        .mic-active { color: #dc3545; font-weight: bold; animation: blink 1s infinite; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        button { padding: 10px 30px; font-size: 1.2rem; cursor: pointer; background: #28a745; color: white; border: none; border-radius: 5px; }
    </style>
</head>
<body>

<div id="game-container">
    <h1>Street Helper</h1>
    <p>å›°ã£ã¦ã„ã‚‹äººã‚’åŠ©ã‘ã‚‹ãŸã‚ã«ã€é©åˆ‡ãªãƒ•ãƒ¬ãƒ¼ã‚ºã‚’ç™ºéŸ³ã—ã‚ˆã†ï¼</p>
    
    <div id="situation-box">ğŸ‘¤</div>
    <div id="instruction">ã“ã®äººã«å£°ã‚’ã‹ã‘ã‚ˆã†ï¼š</div>
    <div id="target-phrase">Ready?</div>
    
    <div id="feedback"></div>
    <button id="start-btn">ã‚²ãƒ¼ãƒ é–‹å§‹ / ãƒã‚¤ã‚¯èµ·å‹•</button>
    
    <div style="margin-top: 30px; color: #888;">
        <p>Status: <span id="status">Wait for start...</span></p>
        <p>Your Voice: <span id="user-speech">...</span></p>
    </div>
</div>

<script>
    const situationBox = document.getElementById('situation-box');
    const targetPhraseEl = document.getElementById('target-phrase');
    const feedbackEl = document.getElementById('feedback');
    const userSpeechEl = document.getElementById('user-speech');
    const statusEl = document.getElementById('status');
    const startBtn = document.getElementById('start-btn');

    // ãƒˆãƒ©ãƒ–ãƒ«ã®ã‚·ãƒãƒ¥ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ãƒªã‚¹ãƒˆ
    const scenarios = [
        { emoji: "ğŸ—ºï¸", hint: "é“ã«è¿·ã£ã¦ã„ã‚‹äººã«ï¼š", phrase: "May I help you?" },
        { emoji: "ğŸ’", hint: "è·ç‰©ãŒé‡ãã†ãªäººã«ï¼š", phrase: "Shall I carry your bag?" },
        { emoji: "â˜•", hint: "æ³¨æ–‡ã‚’é–“é•ãˆã‚‰ã‚ŒãŸå®¢ã«ï¼š", phrase: "I think this is not what she ordered." },
        { emoji: "ğŸš‰", hint: "é§…ã‚’æ¢ã—ã¦ã„ã‚‹äººã«ï¼š", phrase: "The station is just around the corner." },
        { emoji: "ğŸ“¸", hint: "å†™çœŸã‚’æ’®ã£ã¦ã»ã—ãã†ãªäººã«ï¼š", phrase: "Would you like me to take a photo?" }
    ];

    let currentIdx = 0;

    // éŸ³å£°èªè­˜ã®è¨­å®š
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = new SpeechRecognition();
    recognition.lang = 'en-US';
    recognition.interimResults = false;

    function nextScenario() {
        if (currentIdx >= scenarios.length) {
            targetPhraseEl.innerText = "All Clear! Good job!";
            situationBox.innerText = "ğŸ‰";
            return;
        }
        const s = scenarios[currentIdx];
        situationBox.innerText = s.emoji;
        document.getElementById('instruction').innerText = s.hint;
        targetPhraseEl.innerText = s.phrase;
        feedbackEl.innerText = "";
        feedbackEl.style.color = "black";
    }

    startBtn.onclick = () => {
        recognition.start();
        statusEl.innerText = "Listening...";
        statusEl.className = "mic-active";
    };

    recognition.onresult = (event) => {
        const speech = event.results[0][0].transcript.toLowerCase().replace(/[.,?!]/g, "");
        const target = scenarios[currentIdx].phrase.toLowerCase().replace(/[.,?!]/g, "");
        
        userSpeechEl.innerText = speech;
        
        // åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ï¼ˆå®Œå…¨ã«ä¸€è‡´ã—ãªãã¦ã‚‚ã€å«ã¾ã‚Œã¦ã„ã‚Œã°OKã«ã™ã‚‹ï¼‰
        if (speech.includes(target) || target.includes(speech)) {
            feedbackEl.innerText = "Excellent! You helped them! âœ…";
            feedbackEl.style.color = "green";
            currentIdx++;
            setTimeout(nextScenario, 2000);
        } else {
            feedbackEl.innerText = "Pardon? Try again. âŒ";
            feedbackEl.style.color = "red";
        }
    };

    recognition.onend = () => {
        statusEl.innerText = "Stopped (Click button to talk again)";
        statusEl.className = "";
    };

    nextScenario();
</script>
</body>
</html>
